{"version":3,"file":"apiz.umd.js","sources":["../src/core.js","../src/querystring.js","../src/index.js"],"sourcesContent":["/* global DEBUG */\nconst toString = Map.call.bind(Object.prototype.toString);\nconst isObj = o => toString(o) === '[object Object]';\nconst isFn = f => typeof f === 'function';\nconst isStr = s => s && typeof s === 'string';\nconst isEnumerable = Map.call.bind(Object.prototype.propertyIsEnumerable);\n\nlet defaultType,\n\tglobalQuerystring,\n\tglobalParamRegex,\n\tglobalBodyPareser,\n\tglobalClient,\n\tglobalImmutableMeta = false;\n\nconst defaultParamRegex = /:((\\w|-)+)/g,\n\tmethodMap = {\n\t\tGET: noBodyRequest,\n\t\tHEAD: noBodyRequest,\n\t\tPOST: bodyRequest,\n\t\tPUT: bodyRequest,\n\t\tPATCH: bodyRequest,\n\t\tOPTIONS: bodyRequest,\n\t\tDELETE: bodyRequest\n\t};\n\nfunction defaultBodyParser(data, type = 'json', querystring) {\n\tif (type === 'json') {\n\t\treturn JSON.stringify(data);\n\t} else if (type === 'form') {\n\t\treturn querystring(data);\n\t} else {\n\t\treturn data;\n\t}\n}\n\nfunction parseApiInfo(\n\tname,\n\trawInfo,\n\t{ baseURL: gBaseURL, paramRegex, bodyParser, querystring, client }\n) {\n\tlet { url, baseURL, path, method = 'GET', type = defaultType, pathParams = false } = rawInfo;\n\tconst info = {},\n\t\tbURL = baseURL || gBaseURL;\n\n\tif (name === 'remove' || name === 'add') {\n\t\tthrow new Error('\"remove\" and \"add\" is preserved key.');\n\t}\n\tif (!isObj(rawInfo)) {\n\t\tthrow new TypeError(`API ${name} expected an object, but received ${JSON.stringify(rawInfo)}.`);\n\t}\n\tif (isStr(url)) {\n\t\tinfo.url = url;\n\t} else if (isStr(bURL)) {\n\t\tinfo.url = (bURL + (path || '')).replace(/:?\\/\\//g, m => ~m.indexOf(':') ? m : '/');\n\t} else {\n\t\tthrow new Error(`API \"${name}\" must set url or baseURL correctly.`);\n\t}\n\tmethod = method.toUpperCase();\n\tlet methodLowerCase = method.toLowerCase();\n\tif (!['GET', 'HEAD', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'].includes(method)) {\n\t\tthrow new Error(`Unsupported HTTP method: ${method}.`);\n\t}\n\tif (!isFn(client[methodLowerCase])) {\n\t\tthrow new Error(`client must implement a ${methodLowerCase} function.`);\n\t}\n\tinfo.method = method;\n\tinfo.methodLowerCase = methodLowerCase;\n\tinfo[methodLowerCase] = client[methodLowerCase];\n\tinfo.type = type;\n\tinfo.pathParams = pathParams;\n\tinfo.regex = paramRegex;\n\tinfo.querystring = querystring;\n\tinfo.bodyParser = bodyParser;\n\tinfo.init = true;\n\treturn info;\n}\n\nfunction replaceParams(params) {\n\treturn (m, v) => {\n\t\tif (params[v] == null) {\n\t\t\tthrow new Error(`Can't find a property \"${v}\" in params.`);\n\t\t}\n\t\treturn encodeURIComponent(params[v]);\n\t};\n}\n\n// 其实noBodyRequest和bodyRequest我们可以合并成一个,\n// 因为我们已经知道method了, 也就可以知道它是否会带body,\n// 但是考虑到让代码更加清晰一点, 还是拆成两个吧, 这点\n// 代码重复算是可以接受. 另一方面讲, 其实也可以让接口只\n// 实现一个request方法就好, 而不用对每个HTTP方法都实现一个\n// 对应的方法, 因为我们也可以把method传过去\nfunction noBodyRequest(...args) {\n\tconst { methodLowerCase, pathParams, regex, querystring } = this;\n\tlet params, query, qs, url = this.url;\n\tif (args[1] === true) {\n\t\t// 接口处记得检测对象是否为空\n\t\treturn this[methodLowerCase](url, args[0]);\n\t} else if (pathParams) {\n\t\tparams = args[0];\n\t\tquery = args[1];\n\t} else {\n\t\tquery = args[0];\n\t}\n\n\tif (!query && !params) {\n\t\treturn this[methodLowerCase](url);\n\t}\n\n\tif (params) {\n\t\turl = url.replace(regex, replaceParams(params));\n\t} else if (pathParams) {\n\t\tthrow new Error('Path params is required.');\n\t}\n\n\tif (query) {\n\t\tqs = querystring(query);\n\t\turl = ~url.indexOf('?') ? `${url}&${qs}` : `${url}?${qs}`;\n\t}\n\treturn this[methodLowerCase](url);\n}\n\nfunction bodyRequest(...args) {\n\tconst { methodLowerCase, type, pathParams, regex, querystring, bodyParser } = this;\n\tlet rawBody, params, query, body, qs, url = this.url;\n\tif (args[1] === true) {\n\t\treturn this[methodLowerCase](url, args[0], type);\n\t} else if (pathParams) {\n\t\tparams = args[1];\n\t\tquery = args[2];\n\t} else {\n\t\tquery = args[1];\n\t}\n\trawBody = args[0];\n\n\tbody = bodyParser(rawBody, type, querystring);\n\n\tif (params) {\n\t\turl = url.replace(regex, replaceParams(params));\n\t} else if (pathParams) {\n\t\tthrow new Error('Path params is required.');\n\t}\n\n\tif (!query && !params) {\n\t\treturn this[methodLowerCase](url, body, type);\n\t}\n\n\n\tif (query) {\n\t\tqs = querystring(query);\n\t\turl = ~url.indexOf('?') ? `${url}&${qs}` : `${url}?${qs}`;\n\t}\n\treturn this[methodLowerCase](url, body, type);\n}\n\nfunction createAPI(info) {\n\tconst fn = methodMap[info.method].bind(info);\n\t['url', 'method', 'type', 'pathParams'].forEach(k => {\n\t\tObject.defineProperty(fn, k, {\n\t\t\tvalue: info[k],\n\t\t\tenumerable: true,\n\t\t\twritable: false\n\t\t});\n\t});\n\treturn fn;\n}\n\n// 别问, 就是不喜欢ES6 class\nfunction APIz(apiMeta, options) {\n\tlet baseURL,\n\t\timmutableMeta,\n\t\tparamRegex,\n\t\tbodyParser,\n\t\tquerystring,\n\t\tclient,\n\t\tmeta = {};\n\n\tisStr(apiMeta._baseURL) && (baseURL = apiMeta._baseURL);\n\n\t({\n\t\tbaseURL = baseURL,\n\t\timmutableMeta = globalImmutableMeta,\n\t\tparamRegex = globalParamRegex || defaultParamRegex,\n\t\tbodyParser = globalBodyPareser || defaultBodyParser,\n\t\tquerystring = globalQuerystring,\n\t\tclient = globalClient\n\t} = options || {});\n\n\tif (!isFn(querystring)) {\n\t\tthrow new Error('A querystring function must set.');\n\t}\n\n\tif (!client) {\n\t\tthrow new Error('A client must set.');\n\t}\n\n\tconst groupOptions = {\n\t\tbaseURL,\n\t\tparamRegex,\n\t\tbodyParser,\n\t\tquerystring,\n\t\tclient\n\t};\n\n\tif (immutableMeta) {\n\t\tmeta = apiMeta || {};\n\t} else {\n\t\t// 不用Object.keys, 允许配置对象继承\n\t\tfor (const key in apiMeta) {\n\t\t\tif (isObj(apiMeta[key])) {\n\t\t\t\tmeta[key] = parseApiInfo(key, apiMeta[key], groupOptions);\n\t\t\t} else if (key !== '_baseURL') {\n\t\t\t\tconsole.warn(`The ${key} in config is not an object.`);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst pxy = new Proxy({}, {\n\t\tget(target, key, receiver) {\n\t\t\tif (!meta[key] || !isEnumerable(meta, key)) {\n\t\t\t\treturn Reflect.get(target, key);\n\t\t\t} else if (!meta[key].init) {\n\t\t\t\tmeta[key] = parseApiInfo(key, meta[key], groupOptions);\n\t\t\t}\n\t\t\tReflect.set(receiver, key, createAPI(meta[key]));\n\t\t\treturn Reflect.get(receiver, key);\n\t\t},\n\t\tgetPrototypeOf() {\n\t\t\treturn APIz.prototype;\n\t\t}\n\t});\n\n\tconst self = Object.create(pxy);\n\tself.remove = function (name) {\n\t\tthis[name] && (meta[name] = this[name] = undefined);\n\t};\n\tself.add = function (name, apiInfo) {\n\t\tif (meta[name]) {\n\t\t\tthrow new Error(`API \"${name}\" already exists.`);\n\t\t}\n\t\tmeta[name] = parseApiInfo(name, apiInfo, groupOptions);\n\t\tthis[name] = createAPI(meta[name]);\n\t};\n\treturn self;\n}\n\nexport { APIz };\n\nexport function config({ querystring, paramRegex, bodyParser, immutableMeta, client, reset, defaultType: dt } = { reset: true }) {\n\tisFn(querystring) && (globalQuerystring = querystring);\n\tisFn(bodyParser) && (globalBodyPareser = bodyParser);\n\tparamRegex instanceof RegExp && (globalParamRegex = paramRegex);\n\tglobalImmutableMeta = immutableMeta;\n\tglobalClient = client;\n\tdefaultType = dt;\n\treset && (globalQuerystring = globalParamRegex = globalBodyPareser = globalClient = defaultType = undefined, globalImmutableMeta = false);\n}\n","export function querystring(obj) {\n\tif (Object.prototype.toString.call(obj) === '[object Object]') {\n\t\treturn Object.keys(obj)\n\t\t\t.map(\n\t\t\t\tk =>\n\t\t\t\t\tArray.isArray(obj[k])\n\t\t\t\t\t\t? obj[k]\n\t\t\t\t\t\t\t.map(v => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)\n\t\t\t\t\t\t\t.join('&')\n\t\t\t\t\t\t: `${encodeURIComponent(k)}=${encodeURIComponent(obj[k])}`\n\t\t\t)\n\t\t\t.join('&');\n\t} else {\n\t\treturn JSON.stringify(obj);\n\t}\n}","import { config } from './core';\nimport { querystring } from './querystring';\n\nconfig({\n\tquerystring,\n\tdefaultType: 'json'\n});\n\nexport * from './core';"],"names":["toString","Map","call","bind","Object","prototype","isObj","o","isFn","f","isStr","s","isEnumerable","propertyIsEnumerable","defaultType","globalQuerystring","globalParamRegex","globalBodyPareser","globalClient","globalImmutableMeta","defaultParamRegex","methodMap","GET","noBodyRequest","HEAD","POST","bodyRequest","PUT","PATCH","OPTIONS","DELETE","defaultBodyParser","data","type","querystring","JSON","stringify","parseApiInfo","name","rawInfo","baseURL","gBaseURL","paramRegex","bodyParser","client","url","path","method","pathParams","info","bURL","Error","TypeError","replace","m","indexOf","toUpperCase","methodLowerCase","toLowerCase","includes","regex","init","replaceParams","params","v","encodeURIComponent","args","query","qs","rawBody","body","createAPI","fn","forEach","k","defineProperty","value","enumerable","writable","APIz","apiMeta","options","immutableMeta","meta","_baseURL","groupOptions","key","console","warn","pxy","Proxy","get","target","receiver","Reflect","set","getPrototypeOf","self","create","remove","undefined","add","apiInfo","config","reset","dt","RegExp","obj","keys","map","Array","isArray","join"],"mappings":"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"}